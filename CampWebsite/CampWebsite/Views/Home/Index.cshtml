@model IEnumerable<CampWebsite.Models.tCampsite>

@section css{
    <link href="@Url.Content("~/Content/homeindex.css")" rel="stylesheet" />
    <link rel="stylesheet" href="//apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
}
<link rel="stylesheet" href="~/Content/homeindex.css">
<!--entry animation-->
<link href="~/Content/entryAnimation.css" rel="stylesheet" />

<div id="preload_body" class="preload_bg" style="margin: 0; padding: 0; box-sizing: border-box; background-color: #eee; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; top: 0;">
    <div class="preload_container w-100 d-flex justify-content-center">
        <div class="preload_wrap">
            <img src="~/Images/chicken_logo.png" id="animatImage" width="270" />
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#animatImage").on("animationend", function () {
            $("#preload_body").hide();
            $("#preload_heading").hide();
        });
    });

    //function clearHistory() {
    //    localStorage.removeItem("isFirstTime");
    //}

    function checkIfFirstTime() {
        const isFirstTime = sessionStorage.getItem("isFirstTime");
        if (!isFirstTime) {
            sessionStorage.setItem("isFirstTime", true);
            return true;
        }
        return false;
    }

    function checkAnimation() {
        const isFirstTime = checkIfFirstTime();
        if (isFirstTime == true) {
            document.getElementById("preload_body").classList.add("active")
        } else {
            $("#preload_body").hide();
            $("#preload_heading").hide();
        }
    }


    //clearHistory();
    checkAnimation();
</script>
<!-- 大圖部分 -->
<div class="main d-flex justify-content-center flex-column align-items-center position-relative">
    <div>
        <p class="fs-3 mb-3">週末要做什麼</p>
        <h1>來．露過人間</h1>
        <button class="fs-4 mt-3 px-3 py-1" id="gogo">隨心所欲</button>
    </div>
    <button href="" class="position-absolute" id="toHere"><i class="fas fa-chevron-circle-down"></i></button>
</div>

<!-- 快速搜尋 -->
<div class="bg-grey" id="here">
    <div class="container pt-5">
        <div class="row">
            <h3 class="text-center">Night on the Mountain</h3>
            <p class="text-center">
                <i>
                    The fog has risen from the sea and crowned<br />
                    The dark, untrodden summits of the coast,<br />
                    Where roams a voice, in canyons uttermost,<br />
                    From mid­night waters vibrant and profound.
                </i>
            </p>

        </div>
    </div>
    <div class="container search-section">
        <p class="fs-2 fw-bolder main-color pt-5 letter-sp-1">馬上出發吧</p>
        <div class="d-flex justify-content-center my-5">
            <div class="d-flex letter-sp-1 position-relative" id="search_section">
                <input type="text" id="from" autocomplete="off" placeholder="入住日" required>
                <input type="text" id="to" autocomplete="off" placeholder="離開日" required>
                <div class="errorMsg opacity-0">請至少選擇兩天一夜</div>
                <button id="searchBtn"><i class="fas fa-search"><span class="ms-1">搜尋</span></i></button>
            </div>
        </div>
    </div>

    <!-- 區域搜尋分類 -->
    <div class="container class-section mt-5">
        <p class="fs-2 fw-bolder mb-3 main-color letter-sp-1">為下一趟旅程尋找靈感</p>
        <div class="row mb-3 mb-md-5 letter-sp-1">
            <div class="col px-0" id="north">
                <div class="d-flex flex-column align-items-center justify-content-center cover shadow-sm">
                    <i class="fas fa-fish"></i>
                    <p class="fs-3 fw-bolder">北部</p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back shadow-sm">
                    <i class="fas fa-fish"></i>
                    <p class="fs-3 fw-bolder">前往查看</p>
                </div>
            </div>
            <div class="col px-0" id="central">
                <div class="d-flex flex-column align-items-center justify-content-center cover shadow">
                    <i class="fas fa-hippo"></i>
                    <p class="fs-3 fw-bolder">中部</p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back shadow">
                    <i class="fas fa-hippo"></i>
                    <p class="fs-3 fw-bolder">前往查看</p>
                </div>
            </div>
            <div class="col px-0">
                <div class="d-flex flex-column align-items-center justify-content-center cover cover-other shadow">
                    <p class="fs-3 fw-bolder">
                        隨機抽一張<br>北中部天氣
                    </p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back back-other shadow">
                    <p class="fs-3 fw-bolder">
                        <div class="containee weatherArea1">

                        </div>
                    </p>
                </div>
            </div>
        </div>
        <div class="row pb-5 letter-sp-1">
            <div class="col px-0">
                <div class="d-flex flex-column align-items-center justify-content-center cover cover-other shadow">
                    <p class="fs-3 fw-bolder">
                        隨機抽一張<br>東南部天氣
                    </p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back back-other shadow">
                    <p class="fs-3 fw-bolder">
                        <div class="containee weatherArea3">

                        </div>
                    </p>
                </div>
            </div>
            <div class="col px-0" id="south">
                <div class="d-flex flex-column align-items-center justify-content-center cover shadow">
                    <i class="fas fa-crow"></i>
                    <p class="fs-3 fw-bolder">南部</p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back shadow">
                    <i class="fas fa-crow"></i>
                    <p class="fs-3 fw-bolder">前往查看</p>
                </div>
            </div>
            <div class="col px-0" id="east">
                <div class="d-flex flex-column align-items-center justify-content-center cover shadow">
                    <i class="fas fa-paw"></i>
                    <p class="fs-3 fw-bolder">東部</p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center back shadow">
                    <i class="fas fa-paw"></i>
                    <p class="fs-3 fw-bolder">前往查看</p>
                </div>
            </div>
        </div>
    </div>
    @*關鍵字搜尋*@
    <div class="container search-section">
        <p class="fs-2 fw-bolder main-color pt-5 letter-sp-1">心有所屬</p>
        <div class="d-flex justify-content-center my-5">
            <div class="d-flex letter-sp-1 position-relative" id="search_section">
                <select id="sel" list="browsers" class="form-control me-2 con " type="search" aria-label="Search" style="width:320px;">
                    <option value="none" selected disabled hidden>請選擇指定營區</option>
                    @foreach (var A in Model)
                    {
                        <option value="@Html.DisplayFor(modelItem => A.fCampsiteID)">
                            @Html.DisplayFor(modelItem => A.fCampsiteName)
                        </option>
                    }
                </select>

                <button id="searchBtnn"><i class="fas fa-search"><span class="ms-1">搜尋</span></i></button>
            </div>
        </div>
    </div>
</div>

@section scriptBody{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="//apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
}
<script>
    var north = document.querySelector("#north");
    var central = document.querySelector("#central");
    var south = document.querySelector("#south");
    var east = document.querySelector("#east");
    var searchBtn = document.querySelector("#searchBtn");
    var from = document.querySelector("#from");
    var to = document.querySelector("#to");
    var errorMsg = document.querySelector(".errorMsg");
    var gogo = document.querySelector("#gogo")
    gogo.addEventListener("click", function () {
        location.href = "/Search/Search"
    })

    $("#searchBtnn").click(function () {
        var res = $('#sel').val();
        location.href = "/CampSite/Details/" + res;
    })

    searchBtn.addEventListener("click", function () {
        if (from.value != "" && to.value != "") {
            if (from.value == to.value) {
                errorMsg.classList.add("opacity-0");
                let showagain = setTimeout(function () {
                    errorMsg.classList.remove("opacity-0");
                }, 400)
            }
            else {
                document.cookie = `from=${encodeURIComponent(from.value)};path=/;max-age=10`
                document.cookie = `to=${encodeURIComponent(to.value)};path=/;max-age=10`
                location.href = "/Search/Search"
            }
        }
        else {
            errorMsg.classList.remove("opacity-0");
        }
    })
    //按下按鈕時 建立cookie傳到search/search controller
    function addCookie(areaSelected) {
        document.cookie = `area=${encodeURIComponent(areaSelected)};path=/;max-age=10`
        location.href = "/Search/Search";
    }
    north.addEventListener("click", function () {
        addCookie("北部")
    })
    central.addEventListener("click", function () {
        addCookie("中部")
    })
    south.addEventListener("click", function () {
        addCookie("南部")
    })
    east.addEventListener("click", function () {
        addCookie("東部")
    })
    //超過大圖navbar置頂
    var mb_nav = document.querySelector(".mb-nav")
    var main = $(".main")
    var nav = document.querySelector(".navbar")
    $(function () {
        nav.classList.add("bg-transparent")
        nav.classList.remove("bg-333333")
        mb_nav.classList.add("d-none")
    })
    window.addEventListener("scroll", function () {
        if (main.innerHeight() <= $(window).scrollTop()) {
            nav.classList.remove("bg-transparent")
            nav.classList.add("bg-333333")
        }
        else {
            nav.classList.add("bg-transparent")
            nav.classList.remove("bg-333333")
        }
    })
    var toHere = document.querySelector("#toHere");
    toHere.addEventListener("click", function () {
        window.scrollTo({
            top: main.innerHeight() + 10,
            behavior: "smooth"
        })
        nav.classList.remove("bg-transparent")
        nav.classList.add("bg-333333")
    })
</script>

<script>
    $(function () {
        $("#from").datepicker({
            defaultDate: "d",
            changeMonth: true,
            numberOfMonths: 1,
            minDate: "d",
            showButtonPanel: true,
            dateFormat: "yy/mm/dd",
            onClose: function (selectedDate) {
                $("#to").datepicker("option", "minDate", selectedDate);
            }
        });
        $("#to").datepicker({
            defaultDate: "d",
            minDate: "d",
            changeMonth: true,
            numberOfMonths: 1,
            showButtonPanel: true,
            onClose: function (selectedDate) {
                $("#from").datepicker("option", "maxDate", selectedDate);
                if (from.value == selectedDate) {
                    console.log("請至少選擇兩天一夜")
                    errorMsg.classList.remove("opacity-0");
                }
                else {
                    errorMsg.classList.add("opacity-0");
                }
            },
            dateFormat: "yy/mm/dd"
        });
    });

</script>


<script>
    fetch('https://opendata.cwb.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=CWB-C0381432-3F43-4477-BD17-A8A71C74F54E')
        .then(function (response) {
            return response.json();
        })

        .then(function (weatherData) {
            console.log(weatherData);
            var arrayName = ["臺北市", "新北市", "桃園市", "臺中市", "新竹縣", "苗栗縣", "彰化縣", "南投縣", "雲林縣", "金門縣", "連江縣", "基隆市", "新竹市"];
            var i = Math.floor((Math.random() * 13) + 0);
            var Card = document.querySelector(".weatherArea1")
            var Location = weatherData.records.location
            Location.forEach(element => {

                var Name = element.locationName
                var sen = element.weatherElement[3].time[0].parameter.parameterName
                var WX = element.weatherElement[0].time[0].parameter.parameterName
                var POP = element.weatherElement[1].time[0].parameter.parameterName
                var MinT = element.weatherElement[2].time[0].parameter.parameterName
                var MaxT = element.weatherElement[4].time[0].parameter.parameterName

                if (element.locationName == arrayName[i]) {
                    var img_src
                    var Suggest
                    if (POP == 0) {
                        img_src = "https://www.svgrepo.com/show/381333/weather-sun.svg"
                        Suggest = '可以出去玩'
                    } else if (POP < 50) {
                        img_src = "https://www.svgrepo.com/show/381330/weather-cloud.svg"
                        Suggest = '建議要攜帶雨具'
                    } else {
                        img_src = "https://www.svgrepo.com/show/381331/weather-drops-rain.svg"
                        Suggest = '記得攜帶雨具'
                    }


                    Card.innerHTML = `
                                                <div class="card">
                                                    <img src="${img_src}" alt="">
                                                    <div class="card-block">
                                                        <h1>${Name}</h1>
                                                        <p>氣溫:${MinT}&#8451~${MaxT}&#8451</p>
                                                        <p>降雨率:${POP}%</p>
                                                    </div>
                                                </div>
                                                `


                }
                $(".weatherArea1").mouseleave(function () {
                    setTimeout(function () {
                        i = Math.floor((Math.random() * 13) + 0); if (element.locationName == arrayName[i]) {
                            var img_src
                            var Suggest
                            if (POP == 0) {
                                img_src = "https://www.svgrepo.com/show/381333/weather-sun.svg"
                                Suggest = '可以出去玩'
                            } else if (POP < 50) {
                                img_src = "https://www.svgrepo.com/show/381330/weather-cloud.svg"
                                Suggest = '建議要攜帶雨具'
                            } else {
                                img_src = "https://www.svgrepo.com/show/381331/weather-drops-rain.svg"
                                Suggest = '記得攜帶雨具'
                            }


                            Card.innerHTML = `
                                                <div class="card">
                                                    <img src="${img_src}" alt="">
                                                    <div class="card-block">
                                                        <h1>${Name}</h1>
                                                        <p>氣溫:${MinT}&#8451~${MaxT}&#8451</p>
                                                        <p>降雨率:${POP}%</p>
                                                    </div>
                                                </div>
                                                `
                        }
                    }, 500);
                });
            });
        });


</script>



<script>


    fetch('https://opendata.cwb.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=CWB-C0381432-3F43-4477-BD17-A8A71C74F54E')
        .then(function (response) {
            return response.json();
        })

        .then(function (weatherData) {
            console.log(weatherData);
            var arrayName = ["臺南市", "高雄市", "嘉義縣", "屏東縣", "宜蘭縣", "花蓮縣", "臺東縣", "澎湖縣", "嘉義市"];
            var i = Math.floor((Math.random() * 9) + 0);
            var Card = document.querySelector(".weatherArea3")
            var Location = weatherData.records.location
            Location.forEach(element => {

                var Name = element.locationName
                var sen = element.weatherElement[3].time[0].parameter.parameterName
                var WX = element.weatherElement[0].time[0].parameter.parameterName
                var POP = element.weatherElement[1].time[0].parameter.parameterName
                var MinT = element.weatherElement[2].time[0].parameter.parameterName
                var MaxT = element.weatherElement[4].time[0].parameter.parameterName

                if (element.locationName == arrayName[i]) {
                    var img_src
                    var Suggest
                    if (POP == 0) {
                        img_src = "https://www.svgrepo.com/show/381333/weather-sun.svg"
                        Suggest = '可以出去玩'
                    } else if (POP < 50) {
                        img_src = "https://www.svgrepo.com/show/381330/weather-cloud.svg"
                        Suggest = '建議要攜帶雨具'
                    } else {
                        img_src = "https://www.svgrepo.com/show/381331/weather-drops-rain.svg"
                        Suggest = '記得攜帶雨具'
                    }


                    Card.innerHTML = `
                                                <div class="card">
                                                    <img src="${img_src}" alt="">
                                                    <div class="card-block">
                                                        <h1>${Name}</h1>
                                                        <p>氣溫:${MinT}&#8451~${MaxT}&#8451</p>
                                                        <p>降雨率:${POP}%</p>
                                                    </div>
                                                </div>
                                                `


                }
                $(".weatherArea3").mouseleave(function () {
                    setTimeout(function () {
                        i = Math.floor((Math.random() * 9) + 0); if (element.locationName == arrayName[i]) {
                            var img_src
                            var Suggest
                            if (POP == 0) {
                                img_src = "https://www.svgrepo.com/show/381333/weather-sun.svg"
                                Suggest = '可以出去玩'
                            } else if (POP < 50) {
                                img_src = "https://www.svgrepo.com/show/381330/weather-cloud.svg"
                                Suggest = '建議要攜帶雨具'
                            } else {
                                img_src = "https://www.svgrepo.com/show/381331/weather-drops-rain.svg"
                                Suggest = '記得攜帶雨具'
                            }


                            Card.innerHTML = `
                                                <div class="card">
                                                    <img src="${img_src}" alt="">
                                                    <div class="card-block">
                                                        <h1>${Name}</h1>
                                                        <p>氣溫:${MinT}&#8451~${MaxT}&#8451</p>
                                                        <p>降雨率:${POP}%</p>
                                                    </div>
                                                </div>
                                                `
                        }
                    }, 500);
                });
            });
        });


</script>